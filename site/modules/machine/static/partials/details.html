<div class="container-fluid container-position" data-ng-controller="Machine.DetailsController">

    <div data-breadcrumbs></div>
    <div data-ng-show="features.instanceRename == 'enabled'">
        <div data-rename data-object="machine" data-type="'machine'"></div>
    </div>
    <h3 class="page-title" data-ng-hide="features.instanceRename == 'enabled'">
        {{ newInstanceName }}
    </h3>

    <div class="inl-table">
        <div class="left-part">
            <div class="accordion" id="accordion1">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_summary">
                            Summary
                        </a>
            </div>
                    <div id="collapse_summary" class="accordion-body collapse in">
                        <div class="accordion-inner">
                            <table>
                                <tr class="id-section">
                                    <td>UUID</td>
                                    <td>{{machine.id}}</td>
                                </tr>
                                <tr>
                                    <td>Type</td>
                                    <td>{{machine.type}}</td>
                                </tr>
                                <tr>
                                    <td>CN UUID</td>
                                    <td>{{machine.compute_node}}</td>
                                </tr>
                                <tr>
                                    <td>Image UUID</td>
                                    <td>{{machine.image}}</td>
                                </tr>
                                <tr>
                                    <td>Image</td>
                                    <td>{{dataset.name}}</td>
                                </tr>
                                <tr data-ng-show="dataset.version">
                                    <td>Image version</td>
                                    <td>{{dataset.version}}</td>
                                </tr>
                                <tr>
                                    <td>Package</td>
                                    <td>{{machine.package}}</td>
                                </tr>
                                <tr>
                                    <td>Package UUID</td>
                                    <td>{{package.id}}</td>
                                </tr>
                                <tr>
                                    <td>Memory</td>
                                    <td>{{machine.memory && (machine.memory | sizeFormat)}}</td>
                                </tr>
                                <tr>
                                    <td>Disk</td>
                                    <td>{{machine.disk && (machine.disk | sizeFormat)}}</td>
                                </tr>
                                <tr>
                                    <td>IP addresses</td>
                                    <td>
                                        <span data-ng-repeat="ip in machine.ips">{{ip}}{{{true: '', false: ', '}[$last]}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Created</td>
                                    <td>{{machine.created | date:'yyyy-MM-dd HH:mm'}}</td>
                                </tr>
                                <tr>
                                    <td>Datacenter</td>
                                    <td>{{machine.datacenter}}</td>
                                </tr>
                                <tr data-ng-show="machine.primaryIp && dataset.name && (dataset.name != 'Image gone')">
                                    <td>Login</td>
                                    <td data-ng-show="dataset.os && (dataset.os != 'windows')">ssh {{defaultSshUser}}@{{machine.primaryIp}}</td>
                                    <td data-ng-show="dataset.os && (dataset.os == 'windows')">Use Microsoft Remote Desktop (RDP) to connect to {{machine.primaryIp}}. See Credentials section below.</td>
                                </tr>
                            </table>
            </div>
        </div>
    </div>

                <div class="accordion-group" data-ng-show="machine.metadata.credentials">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_credentials">
                            Credentials
                        </a>
                    </div>
                    <div id="collapse_credentials" class="accordion-body collapse">
                        <div class="accordion-inner" data-ng-show="machine.metadata.credentials">
                            <div class="accordion-line">
                                <table data-ng-repeat="(key,credential) in machine.metadata.credentials">
                                    <tr>
                                        <td style="width:140px">System</td>
                                        <td class="credentials">{{credential.system}}</td>
                                    </tr>
                                    <tr>
                                        <td>Username</td>
                                        <td class="credentials">{{credential.username}}</td>
                                    </tr>
                                    <tr>
                                        <td>Password</td>
                                        <td style="min-width: 260px;"><span data-ng-show="isPasswordVisible(key)">************</span><span data-ng-hide="isPasswordVisible(key)" class="credentials">{{credential.password}}</span></td>
                                        <td nowrap>
                                            <a class="btn light show-hide margin-bottom-5 effect-orange-button" data-translate data-ng-click="togglePassword(key)" data-ng-show="isPasswordVisible(key)">Show</a>
                                            <a class="btn light show-hide margin-bottom-5 effect-orange-button" data-translate data-ng-click="togglePassword(key)" data-ng-show="!isPasswordVisible(key)">Hide</a>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="accordion-inner" data-ng-hide="machine.metadata.credentials">
                            <p>There is no credentials for this instance.</p>
                        </div>
                    </div>
                </div>

                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_networks">
                            Networks
                        </a>
                    </div>
                    <div id="collapse_networks" class="accordion-body collapse">
                        <div class="accordion-inner overflow-accordion">
                            <table class="table table-striped table-hover table-full-width">
                                <thead>
                                    <tr class="grid-small-font">
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>ID</th>
                                        <th>Public</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-ng-repeat="network in networks" data-ng-show="network.id" class="ng-scope network">
                                        <td class="ng-binding">{{ $index + 1 }}</td>
                                        <td class="ng-binding">{{ network.name }}</td>
                                        <td class="ng-binding">{{ network.id }}</td>
                                        <td class="ng-binding">{{ network.public }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        </div>
                        </div>

                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_tags">
                            Tags
                        </a>
                    </div>
                    <div id="collapse_tags" class="accordion-body collapse">
                        <div class="accordion-inner">
                            <p>
                                Add tags for convenient instance searching
                                Tags are metadata stored as key-value pairs to make it easier for you to find, sort, and
                                identify your instances.
                            </p>
                            <div data-machine-collection
                                 data-collection="tagsArray"
                                 data-collection-name="'tags'"
                                 data-machine-id="machineid"
                                 class="accordion-max-width detail-tags">
                             </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-group metadata" data-ng-show="instanceMetadataEnabled ">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_metadata">
                            Metadata
                        </a>
                    </div>
                    <div id="collapse_metadata" class="accordion-body collapse">
                        <div class="accordion-inner">
                            <div data-machine-collection
                                 data-collection="metadataArray"
                                 data-collection-name="'metadata'"
                                 data-machine-id="machineid"
                                 class="accordion-max-width detail-mdata">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-group" data-ng-show="machine">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_resize">
                            Resize Instance
                        </a>
                        </div>
                    <div id="collapse_resize" class="accordion-body collapse">
                        <div class="accordion-inner">
                            <p class="" data-translate>
                                It may not always be possible to resize based on the constraints of your current server location.
                            </p>

                            <p data-ng-show="datasetType != 'smartos' && machine.type != 'smartmachine' " data-translate>
                                To resize Linux or Windows instances, you will need to create a instance, migrate and then stop the old instance.
                            </p>
                            <div data-ng-show="datasetType == 'smartos' || machine.type == 'smartmachine' " class="row-fluid">
                                <div class="pull-left row-fluid" data-ng-show="package">
                                    <div>
                                        <p data-translate><b>Current Instance type</b></p>
                                        <span data-ng-show="package.group">
                                            <span  data-ng-show="package.description">{{package.description}}</span><br />
                                            <span data-translate>Type</span>:
                                            <span>{{package.group}}</span>
                                        </span><br />
                                        <span data-translate>Memory</span>:
                                        <span>{{package.memory | sizeFormat}}</span><br />
                                        <span data-translate>Disk</span>:
                                        <span>{{package.disk | sizeFormat}}</span><br />
                                        <span data-ng-show="package.vcpus" data-translate>vCPUs</span>:
                                        <span data-ng-show="package.vcpus">{{package.vcpus}}</span><span data-ng-show="datasetType == 'smartos'"> and bursting</span>
                        </div>
                        </div>
                                <div data-ng-hide="packages.length == 0 || package.selectedMaxPackage" class="resize-block">
                                    <p class="control-label" data-translate><b>Resize Instance type</b></p>
                                    <select name="resize" ui-select2="{width: 375}" data-ng-model="selectedPackage">
                                        <option data-ng-show="machine" data-ng-repeat="package in packages"
                                                value="{{package}}" class="text-medium">
                                            Mem: {{package.memory | sizeFormat}}
                                            Disk: {{package.disk | sizeFormat}}
                                            <span data-ng-show="package.vcpus">VCPU: {{package.vcpus}}</span><span data-ng-show="datasetType == 'smartos'"> and bursting</span>
                                        </option>
                                    </select>
                                    <div class="control-group resize-button">
                                        <button class="btn light pull-right effect-orange-button" type="submit" data-ng-click="clickResize()" data-ng-disabled="!selectedPackage || isResizing" data-translate>Resize</button>
                                        <div class="loading-medium-tr pull-right" data-ng-show="isResizing"></div>
                        </div>
                        </div>
                                <div
                                        data-ng-show="(package.selectedMaxAutomaticPackage || package.selectedMaxPackage)"
                                        class="pull-left resize-block">You currently have maximum possible size of the instance<!--
                                 --><span data-ng-show="package.selectedMaxAutomaticPackage && !package.selectedMaxPackage"> which can be handled automatically</span>.<!--
                                 --></span><span data-ng-show="package.selectedMaxPackage || (package.selectedMaxAutomaticPackage && features.createdBySupportPackages == 'disabled')">&nbsp;<a data-href="#" data-ng-click="contactSupport()">Click here</a> to contact support if you want larger instance.</span>
                                </div>
                                <div class="clearfix"></div>
                        </div>
                        </div>
                        </div>
                    </div>
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_images">
                            Images
                        </a>
                </div>
                    <div id="collapse_images" class="accordion-body create-images collapse" data-ng-show="machine && features.imageCreate == 'enabled'">
                        <div class="accordion-inner">
                            <div class="beta-sticker pull-right tab">beta</div>
                <p>
                                <span class="font-size16" data-translate>Create Image</span>
                </p>

                            <p class="" data-ng-show="imageCreateNotSupported">
                    {{imageCreateNotSupported}}
                </p>
                <div class="clearfix"></div>
                <div>
                    <form name="imageForm">
                        <div class="error"
                             data-ng-show="imageForm.imageName.$error.imageName"
                             data-translate>
                            Image name&nbsp;can contain only letters, digits and signs like '.' and '-'.
                        </div>
                        <div class="error"
                             data-ng-show="imageForm.imageVersion.$error.imageName"
                             data-translate>
                            Image version&nbsp;can contain only letters, digits and signs like '.' and '-'.
                        </div>
                        <div>
                            <div class="dbl-inline">
                                <input type="text"
                                       placeholder="Image name"
                                       name="imageName"
                                       data-ng-model="imageName"
                                       data-ng-disabled="imageJob && !imageJob.finished"
                                       data-machine-name="'image'"
                                       value=""
                                       class="key-width"/>
                            </div>
                            <div>
                                <input type="text"
                                       placeholder="Image version"
                                       name="imageVersion"
                                       data-ng-model="imageVersion"
                                       data-ng-disabled="imageJob && !imageJob.finished"
                                       data-machine-name="'image'"
                                       value=""
                                       class="key-width image-version"/>

                            </div>
                            <div>
                            <textarea type="text"
                                      placeholder="Description (optional)"
                                      name="imageDescription"
                                      data-ng-model="imageDescription"
                                      data-ng-disabled="imageJob && !imageJob.finished"
                                      class="value-width"></textarea>
                            </div>
                            <div class="pull-right">

                                <div class="loading-medium spiner-height" data-ng-show="imageJob && !imageJob.finished"></div>

                                <a class="btn light margin-top-10 dpl-inline effect-orange-button" href="#!/images">My Images List</a>
                                <button class="btn orange dpl-inline margin-top-10"
                                        data-ng-click="clickCreateImage()"
                                        data-translate
                                        data-ng-disabled="(imageJob && !imageJob.finished)">
                                    Create Image
                                </button>
                            </div>
                        </div>
                    </form>
                    <br />
                </div>
                            </div>
                        </div>
                    </div>
                <div class="accordion-group" data-ng-show="features.firewall != 'disabled' && machine">
                    <div class="accordion-heading">
                        <a class="accordion-toggle collapsed toggle-icon" data-toggle="collapse" data-parent="#accordion1"
                           data-target="#collapse_firewall">
                            Cloud Firewall
                        </a>
                    </div>
                    <div id="collapse_firewall" class="accordion-body collapse">
                        <div class="accordion-inner">
                            <div class="beta-sticker pull-right tab">beta</div>
                            <div>
                                <span data-ng-switch="features.firewall">
                                    <fieldset data-ng-switch-when="enabled">
                                        <div data-ng-show="machine.type == 'virtualmachine'">
                                            <div class="item-list-container">
                                                {{machine.type}} instances are not yet supported by the FWAPI.
                                            </div>
                                        </div>
                                        <div data-ng-show="machine.type != 'virtualmachine'">
                                            <div class="item-list-container">
                                                ICMP 8:0 is always open. With Firewall Rules enabled:
                                                <ul>
                                                    <li>Block all inbound traffic</li>
                                                    <li>Allow all outbound traffic</li>
                                                </ul>
                                                The default rules are overridden by your own rules. There is no ordering to your own rules. For incoming traffic, the least restrictive rule wins. For outgoing traffic, the most restrictive rule wins.
                                            </div>
                                        </div>
                                        <div data-ng-show="firewallRules.length >= 1">
                                            <div data-grid-view
                                                 data-user-config="gridUserConfig"
                                                 data-props="gridProps"
                                                 data-items="firewallRules"
                                                 data-paginated="false"
                                                 data-controls="false"
                                                 data-order="gridOrder"
                                                 data-items-type="firewall"
                                                 data-special-width="'detailsPage'"
                                                 data-search-form="searchForm"
                                                 data-export-fields="exportFields"
                                                 data-multisort="false"
                                                 class="grid-small-font indent"></div>
                                        </div>
                                        <div data-ng-show="firewallRules.length < 1"><br/>
                                            <div data-translate>You have no firewall rules that would apply to this machine</div>
                                        </div>
                                        <div class="pull-right">
                                            <div class="loading-medium loading-30 margin-top-10" data-ng-show="fireWallActionRunning"></div>
                                            <a class="btn light margin-top-10 effect-orange-button" href="#!/firewall">Edit</a>
                                            <button class="btn orange margin-top-10"
                                                    data-ng-class="{'btn-success': !machine.firewall_enabled, 'btn-danger': machine.firewall_enabled}"
                                                    data-ng-disabled="fireWallActionRunning || machine.state == 'provisioning'"
                                                    data-ng-show="firewallChangeable()"
                                                    data-ng-click="toggleFirewallEnabled()"
                                                    data-translate-value>{{machine.firewall_enabled && 'Disable' || 'Enable'}}</button>
                                        </div>
                                    </fieldset>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="right-part">
            <div class="details_btn_block">
                <span class="status label label-info pull-left"
                      data-ng-class="{'btn-success': machine.state == 'running'}"
                      data-ng-show="machine.state.length">
                    <span class="loading-small pull-left" data-ng-show="machine.job && !machine.job.finished"></span>
                    <i class="icon-ok" data-ng-show="(machine.state == 'running' && !machine.job) || (machine.state == 'running' && machine.job.finished)"></i>
                    <i class="warn_icon" data-ng-show="(machine.state == 'stopped' && !machine.job) || (machine.state == 'stopped' && machine.job.finished)"></i>
                    <span data-translate>{{machine.state}}</span>
            </span>

                <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'stopped'"
                        data-ng-show="machine.state == 'stopped'"
                        data-ng-click="clickStart(machine.id)"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="Instance configuration and data is preserved when instances are stopped. Use start to restart your instance."

                        class="state btn orange font_size tooltip-hover btn-machine-ctrl">
                    <i class="icon-play"></i>
                    <p data-translate>Start</p>
                </button>

                <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'running'"
                        data-ng-show="machine.state == 'running'"
                        data-ng-click="clickStop(machine.id)"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="{{buttonTooltipText.stop(machine)}}"
                        data-ng-class="{'btn-danger': !((machine.job && !machine.job.finished) || machine.state != 'running')}"
                        class="state btn orange font_size tooltip-hover btn-machine-ctrl">
                    <i class="stop-icon"></i>
                    <p data-translate>Stop</p>
                </button>

                <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'running'"
                                data-ng-click="clickReboot(machine.id)"
                                data-toggle="modal"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                                data-original-title="Click here to reboot your instance."
                                data-ng-class="{'btn-warning': !((machine.job && !machine.job.finished) || machine.state != 'running')}"
                        class="state btn orange font_size tooltip-hover btn-machine-ctrl">
                    <i class="reboot-icon"></i>
                    <p data-translate>Reboot</p>
                </button>

                <button data-ng-disabled="(machine.job && !machine.job.finished) || !isDeleteEnabled(machine.state)"
                        data-ng-click="clickDelete(machine.id)"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="{{buttonTooltipText.delete(machine)}}"
                        data-ng-class="{'btn-danger': !((machine.job && !machine.job.finished) || !isDeleteEnabled(machine.state))}"
                        class="state btn orange font_size tooltip-hover btn-machine-ctrl">
                    <i class="delete-icon"></i>
                    <p data-translate>Delete</p>
                </button>
    </div>
            <div data-ng-controller="cloudController" ng-init="createMachineDetailInstrumentations()">
                <div class="detail_chart">
                    <div class="loading-small" data-ng-hide="cpuGraphs && memGraphs"></div>
                    <graph data-ng-repeat="graph in cpuGraphs" options="graph"></graph>
                    <div class="detail_chart">
                        <graph data-ng-repeat="graph in memGraphs" options="graph"></graph>
                        </div>
                    <div class="detail_chart">
                        <graph data-ng-repeat="graph in nicGraphs" options="graph"></graph>
                    </div>
                        </div>
                <div class="vda-btn">
                    <a id="button-detailed-analytics" href="#!/cloudAnalytics/{{machine.id}}" class="btn light pull-right effect-orange-button"><i class="chart-icon"></i>View Detailed Analytics</a>
                    </div>
                </div>
        </div>
    </div>
</div>
