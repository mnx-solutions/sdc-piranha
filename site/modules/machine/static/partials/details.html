<div class="container-fluid container-position" data-ng-controller="Machine.DetailsController">

<ul class="breadcrumb">
    <li><a href="#!/compute"> Instances</a> /</li>
    <li> Instance Details</li>
</ul>

<h3 class="page-title" data-ng-show="!changingName" data-ng-click="enableRename(machine.name)"><div class="loading-medium wait_rename" data-ng-show="loadingNewName"></div>{{machine.name}}</h3>

<form name="instanceRename" class="machine-edit-form">
    <div class="error"
         data-ng-show="instanceRename.instanceRename.$error.machineName && changingName && newInstanceName != machine.name"
         data-translate>
        Invalid machine name
    </div>

    <div class="error"
         data-ng-show="instanceRename.instanceRename.$error.machineUnique && changingName && newInstanceName != machine.name"
         data-translate>
        Machine name is already in use
    </div>
    <div class="pull-left machine-edit" data-ng-show="changingName">
        <input class="span2 machine-name-edit" id="instanceRename" name="instanceRename" data-ng-model="newInstanceName" type="text" data-machine-name data-machine-unique/>
        <div class="btn-group machine-edit-buttons">
            <button class="btn" data-ng-click="clickRename()" data-ng-disabled="instanceRename.$invalid || newInstanceName.length <= 0 || newInstanceName==machine.name" type="button"><i class="icon-ok"/></button>
            <button class="btn" data-ng-click="cancelRename()" type="button"><i class="icon-remove"/></button>
        </div>
    </div>
</form>

<div class="portlet-body pb-top">
    <div class="inst_left">

    <div class="accordion" id="accordion1">

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-ng-class="{active: accordionIcon[0] }" data-ng-click="collapseTrigger(0)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_1">
                <i class=""></i>
                Meta Data
            </a>
        </div>
        <div id="collapse_1" class="accordion-body collapse in">
            <div class="accordion-inner">
                <table>
                    <tr>
                        <td style="width:140px">UUID</td>
                        <td style="color:#333333;font-weight: bold;">{{machine.id}}</td>
                    </tr>
                    <tr>
                        <td>Instance name</td>
                        <td>{{machine.name}}</td>
                    </tr>
                    <tr>
                        <td>Type</td>
                        <td>{{machine.type}}</td>
                    </tr>
                    <tr>
                        <td>Image UUID</td>
                        <td>{{machine.image}}</td>
                    </tr>
                    <tr>
                        <td>Images<i class="details-images-icon"></i></td>
                        <td>{{dataset.name}}</td>
                    </tr>
                    <tr>
                        <td>Image version</td>
                        <td>{{dataset.version}}</td>
                    </tr>
                    <tr>
                        <td>Memory</td>
                        <td>{{machine.memory | sizeFormat}}</td>
                    </tr>
                    <tr>
                        <td>Disk</td>
                        <td>{{machine.disk | sizeFormat}}</td>
                    </tr>
                    <tr>
                        <td>IP addresses</td>
                        <td>
                            <span data-ng-repeat="ip in machine.ips">{{ip}}{{{true: '', false: ', '}[$last]}}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Created</td>
                        <td>{{machine.created | date:'yyyy-MM-dd HH:mm'}}</td>
                    </tr>
                    <tr>
                        <td>Datacenter</td>
                        <td>{{machine.datacenter}}</td>
                    </tr>
                    <tr data-ng-show="machine.primaryIps.length">
                        <td>login</td>
                        <td data-ng-show="machine.os != 'windows'">ssh root@{{machine.primaryIps[0]}}</td>
                        <td data-ng-show="machine.os == 'windows'">Use remote desktop to connect to {{machine.primaryIps[0]}}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[1] }" data-ng-click="collapseTrigger(1)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_2">
                <i class=""></i>
                Networks
            </a>
        </div>
        <div id="collapse_2" class="accordion-body collapse">
            <div class="accordion-inner overflow-accordion">
                <table class="table table-striped table-hover table-full-width">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>ID</th>
                            <th>Public</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ng-repeat="network in networks" data-ng-show="network.id" class="ng-scope">
                            <td class="ng-binding">{{ $index + 1 }}</td>
                            <td class="ng-binding">{{ network.name }}</td>
                            <td class="ng-binding">{{ network.id }}</td>
                            <td class="ng-binding">{{ network.public }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[2] }" data-ng-click="collapseTrigger(2)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_3">
                <i class=""></i>
                Tags
            </a>
        </div>
        <div id="collapse_3" class="accordion-body collapse">
            <div class="accordion-inner">
                <p>
                    Add tags for convenient instance searching
                    Tags are metadata stored as key-value pairs to make it easier for you to find, sort, and
                    identify your instances.
                </p>
                <div data-tags="tagsArray" machineid="machineid"></div>
            </div>
        </div>
    </div>

    <div class="accordion-group" data-ng-show="machine  && allowResize">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[3]}" data-ng-click="collapseTrigger(3)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_4">
                <i class=""></i>
                Resize Instance
            </a>
        </div>
        <div id="collapse_4" class="accordion-body collapse">
            <div class="accordion-inner">
                <p class="" data-translate>
                    It may not always be possible to resize based on the constraints of your current server location.
                </p>

                <p data-ng-show="datasetType != 'smartos' && machine.type != 'smartmachine' " data-translate>
                    To resize Linux or Windows instances, you will need to create a instance, migrate and then stop the old instance.
                </p>

                <div data-ng-show="datasetType == 'smartos' || machine.type == 'smartmachine' " class="row-fluid " data-ng-class="{'loading-medium': isResizing}">
                    <div class="pull-left" data-ng-show="currentPackage">
                        <div>
                            <p data-translate><b>Current Instance type</b></p>
                            <span data-ng-show="currentPackage.group">
                                <span  data-ng-show="currentPackage.description">{{currentPackage.description}}</span><br />
                                <span data-translate>Type</span>:
                                <span>{{currentPackage.group}}</span>
                            </span><br />
                            <span data-translate>Memory</span>:
                            <span>{{currentPackage.memory | sizeFormat}}</span><br />
                            <span data-translate>Disk</span>:
                            <span>{{currentPackage.disk | sizeFormat}}</span><br />
                            <span data-ng-show="currentPackage.vcpus" data-translate>vCPUs</span>:
                            <span data-ng-show="currentPackage.vcpus">{{currentPackage.vcpus}}</span><span data-ng-show="datasetType == 'smartos'"> and bursting</span>
                        </div>
                    </div>

                    <div class="pull-left resize_block">
                        <p class="control-label" data-translate><b>Resize Instance type</b></p>
                        <select name="resize" ui-select2="{ width: 375}" data-ng-model="selectedPackageName">
                            <option data-ng-show="machine" data-ng-repeat="package in packages | orderBy:sortPackages | filter:filterPackages"
                                    value="{{package.name}}" class="text-medium">
                                Mem: {{package.memory | sizeFormat}}
                                Disk: {{package.disk | sizeFormat}}
                                <span data-ng-show="package.vcpus">VCPU: {{package.vcpus}}</span><span data-ng-show="datasetType == 'smartos'"> and bursting</span>
                            </option>
                        </select>

                        <div class="control-group resize-button">
                            <button class="btn light" type="submit" data-ng-click="clickResize()" data-ng-disabled="!selectedPackage || isResizing" data-translate>Resize</button>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                        </div>
                        </div>
                        </div>
                    </div>
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[4] }" data-ng-click="collapseTrigger(4)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_5">
                <i class=""></i>
                Images
            </a>
                </div>
        <div id="collapse_5" class="accordion-body collapse" data-ng-show="machine && features.imageCreate == 'enabled'">
            <div class="accordion-inner">
                <legend>
                    <span class="font-size16" data-translate>Create Image</span>
                    <div class="beta-sticker pull-right beta"></div>
                </legend>
                <p class="" data-ng-show="machine.state != 'stopped' && !imageCreateNotSupported" data-translate>
                    Instance needs to be stopped before creating an image.
                </p>

                <p class="" data-ng-show="imageCreateNotSupported">
                    {{imageCreateNotSupported}}
                </p>
                <div class="clearfix"></div>
                <div>
                    <form name="imageForm">
                        <div class="error"
                             data-ng-show="imageForm.imageName.$error.imageUnique"
                             data-translate>
                            Image name is already in use
                        </div>
                        <div class="error"
                             data-ng-show="imageForm.imageName.$error.machineName"
                             data-translate>
                            Invalid image name
                        </div>
                        <div>
                            <div class="dpl-inline">
                            <input type="text"
                                placeholder="Image name"
                                name="imageName"
                                data-ng-model="imageName"
                                data-ng-disabled="imageJob && !imageJob.finished"
                                data-machine-name
                                data-image-unique
                                       value=""
                                       class="key-width img-name"/>
                            </div>
                            <div class="dpl-inline">
                            <input type="text" placeholder="Image description (optional)"
                                name="imageDescription"
                                data-ng-model="imageDescription"
                                data-ng-disabled="imageJob && !imageJob.finished"
                                       value=""
                                       class="value-width img-desk"/>
                            </div>
                            <div class="dpl-inline">
                                <div class="loading-medium spiner-height" data-ng-show="imageJob && !imageJob.finished"></div>
                        </div>

                        </div>
                        <button class="btn light dpl-inline margin-top-10"
                                data-ng-click="clickCreateImage()"
                                data-translate
                                data-ng-disabled="(imageJob && !imageJob.finished) || imageForm.$invalid">
                            Create Image
                        </button>
                        <div class="dpl-inline"><a class="btn light margin-top-10" href="#!/images">My Images List</a></div>
                    </form>
                    <br />

                        </div>

                            </div>
                        </div>
                    </div>
    <div class="accordion-group" data-ng-show="machine.metadata.credentials">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[5]}" data-ng-click="collapseTrigger(5)" data-toggle="collapse" data-parent="#accordion1"
                href="#collapse_6">
                <i class=""></i>
                Credentials
            </a>
                        </div>
        <div id="collapse_6" class="accordion-body collapse">
            <div class="accordion-inner" data-ng-show="machine.metadata.credentials">
                <div class="accordiaon-line">
                    <table data-ng-repeat="(key,credential) in machine.metadata.credentials">
                        <tr>
                            <td style="width:140px">System</td>
                            <td >{{credential.system}}</td>
                        </tr>
                        <tr>
                            <td>Username</td>
                            <td>{{credential.username}}</td>
                        </tr>
                        <tr>
                            <td>Password</td>
                            <td style="min-width: 260px;"><span data-ng-show="isPasswordVisible(key)">************</span><span data-ng-hide="isPasswordVisible(key)">{{credential.password}}</span></td>
                            <td nowrap>
                                <a class="btn light show-hide" data-translate data-ng-click="togglePassword(key)" data-ng-show="isPasswordVisible(key)">Show</a>
                                <a class="btn light show-hide" data-translate data-ng-click="togglePassword(key)" data-ng-show="!isPasswordVisible(key)">Hide</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="accordion-inner" data-ng-hide="machine.metadata.credentials">
                <p>There is no credentials for this instance.</p>
            </div>
        </div>
    </div>

    <div class="accordion-group" data-ng-show="features.firewall != 'disabled' && machine">
        <div class="accordion-heading">
            <a class="accordion-toggle collapsed" data-ng-class="{active: accordionIcon[6]}" data-ng-click="collapseTrigger(6)" data-toggle="collapse" data-parent="#accordion1"
               href="#collapse_7">
                <i class=""></i>
                Cloud Firewall
            </a>
        </div>
        <div id="collapse_7" class="accordion-body collapse">
            <div class="accordion-inner overflow-accordion">
            <span data-ng-switch="features.firewall">
                <fieldset data-ng-switch-when="enabled">                
                    <div data-ng-show="machine.type == 'virtualmachine'">
                        <div class="">
                        {{machine.type}} instances are not yet supported by the FWAPI.
                        </div>
                    </div>
                    <div data-ng-show="machine.type != 'virtualmachine'">
                        <div class="">
                            ICMP 8:0 is always open. With Firewall Rules enabled:
                            <ul>
                                <li>Block all inbound traffic</li>
                                <li>Allow all outbound traffic</li>
                            </ul>
                            The default rules are overridden by your own rules. There is no ordering to your own rules. For incoming traffic, the least restrictive rule wins. For outgoing traffic, the most restrictive rule wins.  
                        </div>
                    </div>
                    <div data-ng-show="firewallRules.length >= 1">
                            <div data-grid-view
                                 data-props="gridProps"
                                 data-objects="firewallRules"
                                 data-paginated="false"
                                 data-order="gridOrder"
                                 data-filter-all="{{query}}"
                                 data-objects-type="firewall"></div>
                    </div>
                    <div data-ng-show="firewallRules.length < 1"><br/>
                        <div data-translate>You have no firewall rules that would apply to this machine</div>
                    </div>
                    <div class="pull-left">
                        <a class="btn light margin-top-10" href="#!/firewall">Edit</a>
                        <button class="btn light margin-top-10"
                                data-ng-class="{'btn-success': !machine.firewall_enabled, 'btn-danger': machine.firewall_enabled}"
                                data-ng-disabled="fireWallActionRunning || machine.state == 'provisioning'"
                                data-ng-show="firewallChangeable()"
                                data-ng-click="toggleFirewallEnabled()"
                                data-translate-value>{{machine.firewall_enabled && 'Disable' || 'Enable'}}</button>
                        <div class="loading-medium loading-30 margin-top-10" data-ng-show="fireWallActionRunning"></div>
                    </div>
                </fieldset>
            </span>

        </div>

        </div>
    </div>

</div>
</div>





<div class="pull-left">
    <div class="details_btn_block">
            <span class="status label label-info pull-left"
                  data-ng-class="{'btn-success': machine.state == 'running'}"
                  data-ng-show="machine.state.length">
                <span class="loading-small pull-left" data-ng-show="machine.job && !machine.job.finished"></span>
                <i class="icon-ok" data-ng-show="(machine.state == 'running' && !machine.job) || (machine.state == 'running' && machine.job.finished)"></i>
                <i class="warn_icon" data-ng-show="(machine.state == 'stopped' && !machine.job) || (machine.state == 'stopped' && machine.job.finished)"></i>
                <span data-translate>{{machine.state}}</span>
            </span>

        <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'stopped'"
                data-ng-show="machine.state == 'stopped'"
                        data-ng-click="clickStart(machine.id)"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="Instance configuration and data is preserved when instances are stopped. Use start to restart your instance."

                class="state btn orange font_size tooltip-hover btn-machine-ctrl">
            <i class="icon-play"></i>
            <p data-translate>Start</p>
        </button>

        <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'running'"
                data-ng-show="machine.state == 'running'"
                        data-ng-click="clickStop(machine.id)"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="Stopping an instance does not stop billing. You can restart your instance after you stop your machine."
                        data-ng-class="{'btn-danger': !((machine.job && !machine.job.finished) || machine.state != 'running')}"
                class="state btn orange font_size tooltip-hover btn-machine-ctrl">
            <i class="pause_icon"></i>
            <p data-translate>Stop</p>
        </button>

        <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'stopped'"
                        data-ng-click="clickDelete(machine.id)"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="You will lose all information and data on this instance if you delete an instance. Deleting an instance also stops billing."
                        data-ng-class="{'btn-danger': !((machine.job && !machine.job.finished) || machine.state != 'stopped')}"
                class="state btn orange font_size tooltip-hover btn-machine-ctrl">
            <i class="stop_icon"></i>
            <p data-translate>Delete</p>
        </button>

        <button data-ng-disabled="(machine.job && !machine.job.finished) || machine.state != 'running'"
                        data-ng-click="clickReboot(machine.id)"
                        data-toggle="modal"
                        data-translate-attributes="data-original-title"
                        data-toggle="tooltip"
                        data-placement="top"
                        data-html="true"
                        data-original-title="Click here to reboot your instance."
                        data-ng-class="{'btn-warning': !((machine.job && !machine.job.finished) || machine.state != 'running')}"
                class="state btn orange font_size tooltip-hover btn-machine-ctrl">
            <i class="reboot_icon"></i>
            <p data-translate>Reboot</p>
        </button>
                </div>
    <div data-ng-controller="cloudController" ng-init="createDefaultInstrumentations()">
        <div class="detail_chart" >
            <div class="loading-small" data-ng-hide="cpuGraphs && memGraphs"></div>
            <graph data-ng-repeat="graph in cpuGraphs" options="graph"></graph>

        <div class="detail_chart">
            <graph data-ng-repeat="graph in memGraphs" options="graph"></graph>
            </div>
        <div class="detail_chart">
            <graph data-ng-repeat="graph in nicGraphs" options="graph"></graph>
                    </div>
            </div>
        <div class="vda-btn">
            <a href="#!/cloudAnalytics/{{machine.id}}" class="btn light pull-right "><i class="chart-icon"></i>View Detailed Analytics</a>
            </div>

                    </div>

        </div>
    </div>
</div>