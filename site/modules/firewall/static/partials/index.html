<div class="container-fluid" data-ng-controller="Firewall.IndexController">
    <div class="container firewall-container">
        <div class="row-fluid">
            <div class="span12 page-header">
                <h3 class="page-title">Firewall rules for {{datacenter}}</h3>
                <div class="header-btn">
                    <div data-ng-show="!loading">
                        <div class="btn-group ">
                            <button class="btn" data-ng-show="datacenter">{{datacenter}}</button>
                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <data-notification></data-notification>
        <div data-grid-view
             data-props="gridProps"
             data-objects="rules"
             data-per-page="15"
             data-order="gridOrder"
             data-objects-type="firewall">
        </div>

    <div data-ng-show="loading" class="loading-large"></div>

    <div class="row-fluid notice-block" data-ng-show="notAffectedMachines.length > 0">
        <i class="icon icon-warning-sign"></i>Firewall Rules is a SmartDC v7.1 platform feature. The following instances will not benefit from this feature until their global zone is upgraded by Joyent staff as part of the Q4 2013 - Q1 2014 maintenance:
        <div data-ng-repeat="machine in notAffectedMachines">
            <a href="#!/compute/instance/{{machine.id}}">{{$index+1}}. {{machine.name}} <span class="muted">({{machine.id}})</span></a>
        </div>
    </div>

    <div class="form-horizontal" data-ng-hide="loading" data-ng-model="data">
        <fieldset>
            <legend class="yellow-bg">
                <div class="pull-left title-rule">
                    <span data-ng-show="data.uuid">Edit rule <p class="uuid-text">{{data.uuid}}</p> </span>
                    <span data-ng-hide="data.uuid">Create New Rule</span>
                </div>
                <div class="">
                    <span class="name-field">Action</span>
                    <span class="value-field"><select data-ng-model="data.parsed.action" data-ng-options="action.value as action.title for (key, action) in actions"></select></span>
                    <span class="name-field">Status</span>
                    <span class="value-field"><select data-ng-model="data.enabled" data-ng-options="status.value as status.title for (key, status) in states"></select></span>
                    <span class="name-field">Datacenter</span>
                    <span class="value-field"><select data-ng-model="datacenter" data-ng-options="datacenter.name as datacenter.name for datacenter in datacenters"></select></span>
                </div>
            </legend>
            <table class="firewall-table">
                <tbody>
                    <tr>
                        <td class="one-third">
                            <legend>
                                <span>From</span>
                            </legend>
                            <div class="control-group">
                                <span class="control-label">Add:</span>
                    <span class=" text-medium">
                        <input type="hidden" id="fromSelect" /><br /><br />
                    </span>
                                <form name="fromForm">
                        <span data-ng-switch="current.from.type">
                            <span data-ng-switch-when="wildcard">
                                <span data-ng-show="current.from.text == 'all vms'">
                                    <span class="pull-right f-btn">
                                        <button class="btn light" data-ng-click="addFrom()">ADD</button>
                                    </span>
                                </span>
                            </span>
                            <span data-ng-switch-when="tag">
                                <span class="f-name">Name:</span>
                                <span class="f-value"><input type="text" data-ng-model="current.from.text"/></span>
                                <span data-ng-show="current.from.text">
                                    <span class="f-name margin-top-10">Value:</span>
                                    <span class="f-value margin-top-10"><input type="text" data-ng-model="current.from.value" /></span>
                                </span>
                                <span class="pull-right margin-top-10 f-btn">
                                    <button class="btn light" data-ng-click="addFrom()" data-ng-disabled="fromForm.$invalid || fromForm.$pristine">ADD</button>
                                </span>
                            </span>
                            <span data-ng-switch-default>
                                <!-- due to the nature of directives, we need another switch here -->
                                <span data-ng-switch="current.from.type">
                                    <span data-ng-switch-when="subnet">
                                        <span class="f-name"></span>
                                        <span class="f-value"><input  type="text" name="fromValue" data-ng-model="fromSubnet.address" data-ip/></span>
                                        <span data-ng-show="current.from.text" class="row-fluid">
                                            <span class="f-name margin-top-10">CIDR:</span>
                                            <span class="f-value margin-top-10"><select data-ng-options="c for c in CIDRs" data-ng-model="fromSubnet.CIDR"></select></span>
                                        </span>
                                    </span>
                                    <span data-ng-switch-when="ip">
                                        <span class="f-name"></span>
                                        <span class="f-value"><input type="text" name="fromValue" data-ng-model="current.from.text" data-ip/></span>
                                    </span>
                                    <span data-ng-switch-default>
                                        <span class="f-name"></span>
                                        <span class="f-value"><input type="text" name="fromValue" data-ng-model="current.from.text" /></span>
                                    </span>
                                </span>
                                <span class="pull-right margin-top-10 f-btn">
                                    <button class="btn light" data-ng-click="addFrom()" data-ng-disabled="fromForm.$invalid || fromForm.$pristine">ADD</button>
                                </span>
                                <!-- directives switch end -->
                            </span>
                        </span>
                                </form>
                            </div>
                            <div class="results-group">
                    <span data-ng-show="data.parsed.from.length" class="">
                        <span class="f-result" data-ng-repeat="from in data.parsed.from">
                            <div class="result-width">{{from|targetInfo}}</div>
                            <div class="remove-icon delete pull-right tags-delete-pos" data-ng-click="removeFrom($index)" data-ng-hide="isAny(from)"></div>
                        </span>
                    </span>
                            </div>

                        </td>
                        <td class="small-space"></td>
                        <td class="one-third">
                            <legend>
                                <span>To</span>
                            </legend>
                            <div class="control-group">
                                <span class="control-label">Add:</span>
                    <span class=" text-medium">
                        <input type="hidden" id="toSelect" /><br /><br />
                    </span>
                                <form name="toForm">
                        <span data-ng-switch="current.to.type">
                            <span data-ng-switch-when="wildcard">
                                <span data-ng-show="current.to.text == 'all vms'">
                                    <span class="pull-right f-btn">
                                        <button class="btn light" data-ng-click="addTo()">ADD</button>
                                    </span>
                                </span>
                            </span>
                            <span data-ng-switch-when="tag">
                                <span class="f-name">Name:</span>
                                <span class="f-value"><input type="text" data-ng-model="current.to.text"/></span>
                                <span data-ng-show="current.to.text">
                                    <span class="f-name margin-top-10">Value:</span>
                                    <span class="f-value margin-top-10"><input type="text" data-ng-model="current.to.value" /></span>
                                </span>
                                <span class="pull-right margin-top-10 f-btn">
                                    <button class="btn light" data-ng-click="addTo()" data-ng-disabled="toForm.$invalid || toForm.$pristine">ADD</button>
                                </span>
                            </span>
                            <span data-ng-switch-default>
                                <!-- due to the nature of directives, we need another switch here -->
                                <span data-ng-switch="current.to.type">
                                    <span data-ng-switch-when="subnet">
                                        <span class="f-name"></span>
                                        <span class="f-value"><input  type="text" name="toValue" data-ng-model="toSubnet.address" data-ip/></span>
                                        <span data-ng-show="current.to.text" class="row-fluid">
                                            <span class="f-name margin-top-10">CIDR:</span>
                                            <span class="f-value margin-top-10"><select data-ng-options="c for c in CIDRs" data-ng-model="toSubnet.CIDR"></select></span>
                                        </span>
                                    </span>
                                    <span data-ng-switch-when="ip">
                                        <span class="f-name"></span>
                                        <span class="f-value"><input type="text" name="toValue" data-ng-model="current.to.text" data-ip/></span>
                                    </span>
                                    <span data-ng-switch-default>
                                        <span class="f-name"></span>
                                        <span class="f-value"><input type="text" name="toValue" data-ng-model="current.to.text" /></span>
                                    </span>
                                </span>
                                <span class="pull-right margin-top-10 f-btn">
                                    <button class="btn light" data-ng-click="addTo()" data-ng-disabled="toForm.$invalid || toForm.$pristine">ADD</button>
                                </span>
                                <!-- directives switch end -->
                            </span>
                        </span>
                                </form>
                            </div>

                            <div class="results-group">
                    <span data-ng-show="data.parsed.to.length" class="">
                        <span class="f-result" data-ng-repeat="to in data.parsed.to">
                            <div class="result-width">{{to|targetInfo}}</div>
                            <div class="remove-icon delete pull-right tags-delete-pos" data-ng-click="removeTo($index)" data-ng-hide="isAny(to)"></div>
                        </span>
                    </span>
                            </div>
                        </td>
                        <td class="small-space"></td>
                        <td class="one-third">
                            <legend>
                                <span>Ports</span>
                            </legend>
                            <div class="">
                                <label class="control-label">Protocol:</label>
                                <form name="protocolForm">
                                    <!--<div class="controls warning">-->
                            <span class="">
                                <select data-ng-model="data.parsed.protocol.name" data-ng-options="protocol.value as protocol.title for (key, protocol) in protocols"></select><br/><br/>
                                <span data-ng-show="data.parsed.protocol.name && data.parsed.protocol.name != 'icmp' && !isAllPorts()">
                                    <!--<span class="row-fluid">-->
                                    <span class="f-name"></span>
                                    <span class="f-value"><input name="port"
                                                                 type="text"
                                                                 data-ng-model="current.port"
                                                                 data-range="1-65535"/>
                                    </span>
                                    <!--</span>-->
                                    <!--<span class="row-fluid">-->
                                        <span class="pull-right margin-top-10 f-btn">
                                            <button class="btn light"
                                                    data-ng-disabled="!protocolForm.port.$dirty || protocolForm.port.$error.range"
                                                    data-ng-click="addPort()">ADD</button>
                                            <button class="btn orange" data-ng-click="useAllPorts()">Use All</button>
                                        </span>
                                    <!--</span>-->
                                </span>
                                <span data-ng-show="data.parsed.protocol.name && data.parsed.protocol.name == 'icmp'">
                                    <!--<span class="row-fluid">-->
                                        <span class="f-name">Type:</span>
                                        <span class="f-value"><input type="text"
                                                                     name="type"
                                                                     data-ng-required="true"
                                                                     data-range="0-255"
                                                                     data-ng-model="current.type" />
                                        </span>
                                    <!--</span>-->
                                    <!--<span class="row-fluid">-->
                                        <span class="f-name margin-top-10">Code:</span>
                                        <span class="f-value margin-top-10"><input type="text"
                                                                                   name="code"
                                                                                   data-ng-required="false"
                                                                                   data-range="0-255"
                                                                                   data-ng-model="current.code" />
                                        </span>
                                    <!--</span>-->
                                    <!--<span class="row-fluid">-->
                                        <span class="pull-right margin-top-10 f-btn">
                                            <button class="btn light"
                                                    data-ng-disabled="!protocolForm.$valid"
                                                    data-ng-click="addType()">ADD</button>
                                        </span>
                                    <!--</span>-->
                                </span>
                            </span>

                                    <!--</div>-->
                                </form>
                            </div>

                            <div class="results-group">
                    <span data-ng-show="data.parsed.to.length" class="">
                        <span class="f-result" data-ng-repeat="target in data.parsed.protocol.targets">
                            <div class="result-width">{{target}}</div>
                            <div class="remove-icon delete pull-right tags-delete-pos" data-ng-click="removeProtocolTarget($index)" ></div>
                        </span>
                    </span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="create-update-btn">
                <span class="value-field" data-ng-show="data.uuid"><a class="btn orange" data-ng-click="resetData()">Create New Instead</a></span>
                <button class="btn light" data-ng-hide="data.uuid" data-ng-disabled="!validData" data-ng-click="createRule()">Create Rule</button>
                <button class="btn light" data-ng-show="data.uuid" data-ng-disabled="!validData" data-ng-click="updateRule()">Update Rule</button>
            </div>
        </fieldset>

    </div>

</div>
</div>
