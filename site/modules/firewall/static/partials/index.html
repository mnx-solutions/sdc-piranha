<div class="container-fluid" data-ng-controller="Firewall.IndexController">
    <div class="container">
        <select class="pull-right" data-ng-model="datacenter" data-ng-options="datacenter as datacenter for (datacenter, rules) in rulesByDatacenter"></select>
        <h1 class="pull-left">Firewall rules for {{datacenter}}</h1>
        <div class="clearfix"></div>

        <div class="item header row-fluid">

            <span class="span3 text-mediume">
                <span class="pull-left" data-translate>From</span>
            </span>

            <span class="span3 text-medium">
                <span class="pull-left" data-translate>To</span>
            </span>

            <span class="span1 text-medium sortable"
                  data-ng-click="sortBy('action')"
                  data-ng-switch on="sortIcon.action">
                <span class="pull-left" data-translate>Action</span>
                <i class="icon-arrow-up" data-ng-switch-when="up"></i>
                <i class="icon-arrow-down" data-ng-switch-when="down"></i>
            </span>

            <span class="span1 text-medium" data-translate>Protocol</span>

            <span class="span1 text-medium sortable state-sortable-header"
                  data-ng-click="sortBy('state')"
                  data-ng-switch on="sortIcon.status">
                <span class="pull-left" data-translate>Enabled</span>
                <i class="icon-arrow-up" data-ng-switch-when="up"></i>
                <i class="icon-arrow-down" data-ng-switch-when="down"></i>
            </span>
            <span class="span1 text-medium">
                <span class="pull-left" data-translate></span>
            </span>
            <span class="span1 text-medium">
                <span class="pull-left" data-translate></span>
            </span>
        </div>


        <div data-ng-repeat="rule in rules" class="item row-fluid">
            <span class="span3 text-medium">
                <span data-ng-show="rule.parsed.from.length">
                    <span data-ng-repeat="from in rule.parsed.from">{{from|targetInfo}}<br/></span>
                </span>
            </span>
            <span class="span3 text-medium">
                <span data-ng-show="rule.parsed.to.length">
                    <span data-ng-repeat="to in rule.parsed.to">{{to|targetInfo}}<br/></span>
                </span>
            </span>
            <span class="span1 text-medium">{{rule.parsed.action}}</span>
            <span class="span1 text-medium">
                {{rule.parsed.protocol.name}} <br/>
                targets: <br/><span data-ng-repeat="target in rule.parsed.protocol.targets">{{target}}<br/></span>
            </span>
            <span class="span1 text-medium">{{rule.enabled}}</span>
            <span class="span1 text-medium pointer" data-ng-click="editRule(rule)">Edit</span>
            <span class="span1 text-medium pointer" data-ng-click="deleteRule()">Delete</span>
        </div>

        <div data-ng-model="data">
            <h3>{{data.id && 'Edit rule '+ data.id || 'Create New Rule' }}</h3>
            <div class="item row-fluid">
                <h4>From</h4><hr/>
                <div>
                    <span class="span10 text-medium">
                    <span data-ng-show="data.parsed.from.length">
                        <span data-ng-repeat="from in data.parsed.from">
                            {{from|targetInfo}} <span data-ng-hide="from[0] == 'wildcard'" class="pointer" data-ng-click="removeFrom($index)">[ x ]</span>
                            <br/>
                        </span>
                    </span>
                    <select data-ng-model="current.fromType" data-ng-options="target.value as target.title for (key, target) in targetTypes"></select><br/>
                    <span data-ng-switch="current.fromType">
                        <span data-ng-switch-when="wildcard">
                            <span class="pointer" data-ng-click="addAnyFrom()">USE ANY</span>
                        </span>
                        <span data-ng-switch-when="tag">
                            <span>Tag name: </span><input data-ng-model="current.from" /><br/>
                            <span data-ng-show="current.from">Tag value (optional): <input data-ng-model="current.fromTagValue" /></span>
                            <span class="pointer" data-ng-click="addFrom()">ADD</span>
                        </span>
                        <span data-ng-switch-default>
                            {{current.fromType}}: <input data-ng-model="current.from" /><br/>
                            <span class="pointer" data-ng-click="addFrom()">ADD</span>
                        </span>

                    </span>
                    </span>
                </div>
                <div class="clearfix"></div><hr/>
                <h4>To</h4><hr/>
                <div>
                    <span class="span10 text-medium">
                    <span data-ng-show="data.parsed.to.length">
                        <span data-ng-repeat="to in data.parsed.to">
                            {{to|targetInfo}} <span data-ng-hide="to[0] == 'wildcard'" class="pointer"  data-ng-click="removeTo($index)">[ x ]</span>
                            <br/>
                        </span>
                    </span>
                    <select data-ng-model="current.toType" data-ng-options="target.value as target.title for (key, target) in targetTypes"></select><br/>
                    <span data-ng-switch="current.toType">
                        <span data-ng-switch-when="wildcard">
                            <span class="pointer" data-ng-click="addAnyTo()">USE ANY</span>
                        </span>
                        <span data-ng-switch-when="tag">
                            <span>Tag name: </span><input data-ng-model="current.to" /><br/>
                            <span data-ng-show="current.to">Tag value (optional): <input data-ng-model="current.toTagValue" /></span>
                            <span class="pointer" data-ng-click="addTo()">ADD</span>
                        </span>
                        <span data-ng-switch-default>
                            {{current.toType}}: <input data-ng-model="current.to" /><br/>
                            <span class="pointer" data-ng-click="addTo()">ADD</span>
                        </span>

                    </span>
                </span>
                </div>
                <div class="clearfix"></div><hr/>
                <h4>Action</h4><hr/>
                <div>
                    <span class="span10 text-medium"><select data-ng-model="data.parsed.action" data-ng-options="action.value as action.title for (key, action) in actions"></select></span>

                </div>
                <div class="clearfix"></div><hr/>
                <h4>Protocol</h4><hr/>
                <div>
                    <span class="span10 text-medium">
                    <select data-ng-model="data.parsed.protocol.name" data-ng-options="protocol.value as protocol.title for (key, protocol) in protocols"></select><br/>
                    <span data-ng-show="data.parsed.protocol.name && data.parsed.protocol.name != 'icmp'">
                        ports: <br/><span data-ng-repeat="target in data.parsed.protocol.targets">{{target}}<br/></span>
                        <input data-ng-model="currentPort" /><br/>
                        <span class="pointer" data-ng-click="addPort()">ADD</span>
                    </span>
                </span>
                </div>
                <div class="clearfix"></div><hr/>
                <h4>Status</h4><hr/>
                <div>
                    <span class="span10 text-medium">
                    <select data-ng-model="data.enabled" data-ng-options="status.value as status.title for (key, status) in states"></select>
                </span>
                </div>

                <div class="clearfix"></div><hr/>
                <span class="pointer" data-ng-click="createRule()">{{data.id && 'Update rule' || 'Create Rule' }}</span>
            </div>


        </div>
    </div>
</div>

